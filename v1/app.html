<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PattySecretFormula</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6">
                <h4 class="text-primary"><i class="fas fa-calculator"></i> Input</h4>
                <div id="info-dialog" class="card p-4 shadow-lg">
                    <form id="calculation-form">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="Nom"><i class="fas fa-user"></i> Nom</label>
                                <input type="text" id="Nom" class="form-control" placeholder="Entrez votre nom" required>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="Prenom"><i class="fas fa-user"></i> Prénom</label>
                                <input type="text" id="Prenom" class="form-control" placeholder="Entrez votre prénom" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group col-md-4">
                                <label for="DateNaissance"><i class="fas fa-calendar-alt"></i> Date de Naissance</label>
                                <input type="date" id="DateNaissance" class="form-control" required>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="Poids"><i class="fas fa-weight"></i> Poids (kg)</label>
                                <input type="number" id="Poids" class="form-control" placeholder="Ex: 70" required>
                            </div>
                            <div class="form-group col-md-4">
                                <label for="Taille"><i class="fas fa-ruler-vertical"></i> Taille (cm)</label>
                                <input type="number" id="Taille" class="form-control" placeholder="Ex: 175" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="Sexe"><i class="fas fa-venus-mars"></i> Sexe</label>
                                <select id="Sexe" class="form-control" required>
                                    <option value="male">Homme</option>
                                    <option value="female">Femme</option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label><i class="fas fa-running"></i> Niveau d'activité physique (NAP)</label>
                                <div>
                                    <div class="form-check">
                                        <input type="radio" name="Nap" id="sedentaire" value="1.2" required>
                                        <label for="sedentaire" data-toggle="tooltip" title="Peu d'activité">Sédentaire</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" name="Nap" id="leger" value="1.375" required>
                                        <label for="leger" data-toggle="tooltip" title="Activité légère">Léger</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" name="Nap" id="modere" value="1.55" required>
                                        <label for="modere" data-toggle="tooltip" title="Activité modérée">Modéré</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" name="Nap" id="actif" value="1.725" required>
                                        <label for="actif" data-toggle="tooltip" title="Activité intense">Actif</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" name="Nap" id="tresActif" value="1.9" required>
                                        <label for="tresActif" data-toggle="tooltip" title="Activité très intense">Très actif</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary mt-3 w-100"><i class="fas fa-calculator"></i> Calculer</button>
                    </form>

                    <hr>

                    <h4 class="text-primary"><i class="fas fa-file-import"></i> Importer</h4>
                    <div class="card shadow p-4">
                        <p>Importez un fichier pour remplir les données du formulaire automatiquement.</p>
                        <input type="file" id="fileInput" class="form-control-file" accept=".csv">
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <h4 class="text-primary"><i class="fas fa-chart-bar"></i> Output</h4>
                <div class="card shadow mb-3 p-3">
                    <h5 class="card-title"><i class="fas fa-wallet"></i> Argent</h5>
                    <p><strong>Solde estimé :</strong> <span id="SoldeEstime">0</span> €</p>
                    <p><strong>Économies mensuelles :</strong> <span id="EconomiesMensuelles">0</span> €</p>
                </div>
                
                <div class="card shadow mb-3 p-3">
                    <h5 class="card-title"><i class="fas fa-heartbeat"></i> Santé</h5>
                    <p><strong>Nom et Prénom :</strong> <span id="NomPrenom">-</span></p>
                    <p><strong>Âge :</strong> <span id="NiveauAge">-</span> ans</p>                
                    <p><strong>MB (Métabolisme de Base) :</strong> <span id="MetabolismeBase">-</span> kcal</p>
                    <p><strong>Dépense Énergétique Journalière (DEJ) :</strong> <span id="DepenseEnergetiqueJournaliere">-</span> kcal</p>
                </div>
                
                <div class="card shadow p-3">
                    <h5 class="card-title"><i class="fas fa-flag-checkered"></i> Quêtes</h5>
                    <div class="mb-3">
                        <label class="progress-label">Âge actuel / Espérance de vie</label>
                        <div class="progress">
                            <div id="TempsRestant_progress" class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small><span id="TempsRestantDecimal">0</span> ans - <span id="TempsRestantPourcentage">0%</span></small>
                    </div>
                    
                    <div>
                        <label class="progress-label">Calories consommées / Dépense Énergétique Journalière (DEJ)</label>
                        <div class="progress">
                            <div id="Calories_meter" class="progress-bar bg-warning" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small><span id="CaloriesDecimal">0</span> kcal - <span id="CaloriesPercentage">0%</span></small>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>

    <script>
        // ========================
        // 1. Données et localStorage
        // ========================

        // Récupère les données du formulaire
        function getFormData() {
            return {
                nom: document.getElementById("Nom").value,
                prenom: document.getElementById("Prenom").value,
                dateNaissance: document.getElementById("DateNaissance").value,
                poids: parseFloat(document.getElementById("Poids").value),
                taille: parseFloat(document.getElementById("Taille").value),
                sexe: document.getElementById("Sexe").value,
                nap: parseFloat(document.querySelector('input[name="Nap"]:checked').value),
            };
        }

        // Enregistre les données dans localStorage
        function saveToLocalStorage(data) {
            localStorage.setItem("userData", JSON.stringify(data));
        }

        // Récupère les données depuis localStorage
        function loadFromLocalStorage() {
            const data = localStorage.getItem("userData");
            return data ? JSON.parse(data) : null;
        }

        // Charge les données sauvegardées (si présentes) dans le formulaire
        function populateForm() {
            const data = loadFromLocalStorage();
            if (data) {
                document.getElementById("Nom").value = data.nom;
                document.getElementById("Prenom").value = data.prenom;
                document.getElementById("DateNaissance").value = data.dateNaissance;
                document.getElementById("Poids").value = data.poids;
                document.getElementById("Taille").value = data.taille;
                document.getElementById("Sexe").value = data.sexe;
                document.querySelector(`input[name="Nap"][value="${data.nap}"]`).checked = true;
            }
        }

        // ========================
        // 2. Calculs et formules
        // ========================

        // Calcul de l'âge
        function calculateAge(dateNaissance) {
            const birthDate = new Date(dateNaissance);
            const ageDifMs = Date.now() - birthDate.getTime();
            const ageDate = new Date(ageDifMs);
            return Math.abs(ageDate.getUTCFullYear() - 1970);
        }

        // Calcul du Métabolisme de Base (MB)
        function calculateMetabolismeBase(poids, taille, age, sexe) {
            return sexe === "male"
                ? 88.362 + (13.397 * poids) + (4.799 * taille) - (5.677 * age)
                : 447.593 + (9.247 * poids) + (3.098 * taille) - (4.330 * age);
        }

        // Calcul de la Dépense Énergétique Journalière (DEJ)
        function calculateDEJ(metabolismeBase, nap) {
            return metabolismeBase * nap;
        }

        // ========================
        // 3. Mise à jour et affichage des résultats
        // ========================

        function updateResults() {
            // Récupération des données du formulaire
            const data = getFormData();

            // Calcul de l'âge
            const age = calculateAge(data.dateNaissance);
            
            // Calculs du métabolisme de base (MB) et des dépenses énergétiques (DEJ)
            const metabolismeBase = calculateMetabolismeBase(data.poids, data.taille, age, data.sexe);
            const depenseEnergetiqueJournaliere = calculateDEJ(metabolismeBase, data.nap);

            // Mise à jour des éléments de la page avec les résultats
            document.getElementById("NomPrenom").textContent = `${data.nom} ${data.prenom}`;
            document.getElementById("NiveauAge").textContent = age;
            document.getElementById("MetabolismeBase").textContent = metabolismeBase.toFixed(2);
            document.getElementById("DepenseEnergetiqueJournaliere").textContent = depenseEnergetiqueJournaliere.toFixed(2);

            // Mise à jour du localStorage
            saveToLocalStorage(data);

            // Met à jour les indicateurs de progrès
            updateProgressBars(age, depenseEnergetiqueJournaliere);
        }

        // Mise à jour des progress bars pour la quête
        function updateProgressBars(age, dej) {
            // Espérance de vie moyenne (valeur hypothétique ici)
            const esperanceVie = 80;
            const tempsRestantPourcentage = (age / esperanceVie) * 100;

            document.getElementById("TempsRestant_progress").style.width = `${tempsRestantPourcentage}%`;
            document.getElementById("TempsRestantDecimal").textContent = esperanceVie - age;
            document.getElementById("TempsRestantPourcentage").textContent = `${Math.round(tempsRestantPourcentage)}%`;

            // Exemples d'objectifs caloriques
            const caloriesConsommees = 2000; // Valeur de base à changer selon vos besoins
            const caloriesPourcentage = (caloriesConsommees / dej) * 100;

            document.getElementById("Calories_meter").style.width = `${caloriesPourcentage}%`;
            document.getElementById("CaloriesDecimal").textContent = caloriesConsommees;
            document.getElementById("CaloriesPercentage").textContent = `${Math.round(caloriesPourcentage)}%`;
        }

        // Initialisation de l'application et écoute de l'événement "submit" du formulaire
        document.addEventListener("DOMContentLoaded", function () {
            populateForm(); // Remplit le formulaire si les données existent
            document.getElementById("calculation-form").addEventListener("submit", function (event) {
                event.preventDefault();
                updateResults();
            });
        });
    </script>

</body>
</html>
